spec:
  alerts:
  - rule: DEPLOYMENT_FAILED
  - rule: DOMAIN_FAILED
  features:
  - buildpack-stack=ubuntu-22
  ingress: {}
  name: clawdbot
  region: tor
  workers:
  - dockerfile_path: /Dockerfile
    envs:
    # Required
    - key: SETUP_PASSWORD
      scope: RUN_TIME
      type: SECRET
    - key: CLAWDBOT_STATE_DIR
      scope: RUN_AND_BUILD_TIME
      value: /data/.clawdbot
    - key: CLAWDBOT_WORKSPACE_DIR
      scope: RUN_AND_BUILD_TIME
      value: /data/workspace
    # Gateway mode: tailscale for private access
    - key: CLAWDBOT_GATEWAY_MODE
      scope: RUN_AND_BUILD_TIME
      value: tailscale
    # Tailscale configuration
    - key: TS_AUTHKEY
      scope: RUN_TIME
      type: SECRET
    - key: TS_HOSTNAME
      scope: RUN_AND_BUILD_TIME
      value: clawdbot
    - key: TS_USERSPACE
      scope: RUN_AND_BUILD_TIME
      value: "true"
    - key: TS_SOCKET
      scope: RUN_AND_BUILD_TIME
      value: /tmp/tailscaled.sock
    # Optional: Uncomment for Spaces persistence
    # - key: LITESTREAM_ACCESS_KEY_ID
    #   scope: RUN_TIME
    #   type: SECRET
    # - key: LITESTREAM_SECRET_ACCESS_KEY
    #   scope: RUN_TIME
    #   type: SECRET
    # - key: SPACES_ENDPOINT
    #   scope: RUN_AND_BUILD_TIME
    #   value: tor1.digitaloceanspaces.com
    # - key: SPACES_BUCKET
    #   scope: RUN_AND_BUILD_TIME
    #   value: clawdbot-backup
    # Optional: Uncomment for Gradient AI
    # - key: GRADIENT_API_KEY
    #   scope: RUN_TIME
    #   type: SECRET
    github:
      branch: main
      deploy_on_push: true
      repo: digitalocean-labs/clawdbot-appplatform
    instance_count: 1
    instance_size_slug: apps-s-2vcpu-4gb
    name: clawdbot
    source_dir: /
